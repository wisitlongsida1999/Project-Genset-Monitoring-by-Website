<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="icon" href="img/kmitl_logo.png" type="image/png">
<title>KMITL Generator Set Controlling</title>


<!-- stylesheets -->
<link href="assets/fonts/font-roboto.css" rel="stylesheet">
<link href="assets/bootstrap/bootstrap4-alpha3.min.css" rel="stylesheet">
<link href="assets/font-awesome/css/font-awesome.min.css" rel="stylesheet">
<link href="assets/web-analytics/style.css" rel="stylesheet">

<!-- scripts -->
<script src="assets/jquery/jquery-3.1.0.min.js"></script>
<script src="assets/tether/tether.min.js"></script>
<script src="assets/bootstrap/bootstrap4-alpha3.min.js"></script>
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
<script src="assets/web-analytics/real-time.js"></script>

<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/3.3.2/firebase.js"></script>

<!-- canvasjs -->
<script src="js/jquery.canvasjs.min.js"></script>

<!-- Material Design fonts -->
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700" />
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  
<!-- Bootstrap -->
<link rel="stylesheet" href="css/bootstrap.min.css">

<link rel="stylesheet" href="css/ripples.min.css">
<script src="js/bootstrap.min.js"></script>
<script src="js/material.min.js"></script>
<script src="js/ripples.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">


<!-- Animate.css -->
<link rel="stylesheet" href="css/animate.min.css">


</head>
 
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  </head>



  <body>

   <!-- header -->
	<nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
		<div class="container-fluid">
			<a class="navbar-brand" href="Index.html">
				<img src="img/unnamed.png"  width="70" height="55" class="d-inline-block align-top">
			
			
			  </a>
		  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		  </button>
		  <div class="collapse navbar-collapse" id="navbarSupportedContent">
			<ul class="navbar-nav me-auto mb-2 mb-lg-0">
			  <li class="nav-item">
				<a class="nav-link active" aria-current="page" href="Index.html">Real Time Monitoring </a>
			  </li>
			  <li class="nav-item">
				<a class="nav-link" href="control.html">Controlling</a>
			  </li>
			  <li class="nav-item dropdown">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
				  History
				</a>
				<ul class="dropdown-menu" aria-labelledby="navbarDropdown">
				  <li><a class="dropdown-item" href="table.html">Table</a></li>
				  <li><hr class="dropdown-divider"></li>
				  <li><a class="dropdown-item" href="graph.html">Graph</a></li>
				</ul>
			  </li>
			  <li class="nav-item">
				<a class="nav-link" href="map2.html">Realtime Location</a>
			  </li>
			  <li class="nav-item dropdown">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
				  About Us
				</a>
				<ul class="dropdown-menu" aria-labelledby="navbarDropdown">
				  <li><a class="dropdown-item" href="project.html">Project</a></li>
				  <li><hr class="dropdown-divider"></li>
				  <li><a class="dropdown-item" href="advisor.html">Advisor</a></li>
				  <li><a class="dropdown-item" href="member.html">Member</a></li>
				</ul>
			  </li>
			
			</ul>
			<form class="d-flex">
			  <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
			  <button class="btn btn-outline-success" type="submit">Search</button>
			</form>
		  </div>
		</div>
	  </nav>
		<br></br><br></br>

   
  

    <h3>Control Relay</h3>
    Relay 1  : 
    <button type="button"  class="btn btn-success" id="Relay_1_button_on">ON</button>
    <button type="button" class="btn btn-danger" id="Relay_1_button_off">OFF</button>
    คำสั่งที่ส่งไป Firebase : 
    <span id="r1_send_tr"></span>
     คำสั่งล่าสุดที่ตอบกลับมา :
     <span id="Relay_1_recieve"></span>
     สถานะปัจจุบันของรีเลย์ :
     <span id="Relay_1_now"></span>
     การเชื่อมต่อระหว่างFirebase กับ ESPP8266 :
     <span id="r1_recieve_tr"></span> 
     วันครบกำนด :
     <span id="r1_chk_date_tr"></span> 
    <br></br>
    Relay 2  : 
    <button type="button" class="btn btn-success" id="Relay_2_button_on">ON</button>
    <button type="button" class="btn btn-danger" id="Relay_2_button_off">OFF</button>
    คำสั่งที่ส่งไป Firebase :
    <span id="r2_send_tr"></span>  
    คำสั่งล่าสุดที่ตอบกลับมา :
    <span id="Relay_2_recieve"></span> 
    สถานะปัจจุบันของรีเลย์ :
    <span id="Relay_2_now"></span> 
    การเชื่อมต่อระหว่างFirebase กับ ESPP8266 : 
    <span id="r2_recieve_tr"></span> 
    วันครบกำนด :
    <span id="r2_chk_date_tr"></span> 
    <br></br>


    
    
  
    
          <!-- The core Firebase JS SDK is always required and must be listed first -->
          <script src="https://www.gstatic.com/firebasejs/5.9.2/firebase.js"></script>

       <script>
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        var firebaseConfig = {
                apiKey: "AIzaSyBVJmUaLgzix7iEobfhd2RQotH0zFEPDCM",
              authDomain: "genset-10faf.firebaseapp.com",
              databaseURL: "https://genset-10faf-default-rtdb.firebaseio.com",
              projectId: "genset-10faf",
              storageBucket: "genset-10faf.appspot.com",
              messagingSenderId: "49975101968",
              appId: "1:49975101968:web:fb65e2d12db631de275895",
              measurementId: "G-K2TLE0PQHQ"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Get a reference to the database service
        
        var database = firebase.database();

        database.ref('/Genset control/Input command/Relay/R/R1').on('value', snap => $("#Relay_1_send").text(snap.val()));
        database.ref('/Genset control/Input command/Relay/R/R2').on('value', snap => $("#Relay_2_send").text(snap.val()));
        database.ref('/Genset control/Output status/ORelay/Last/L/OR1last').on('value', snap => $("#Relay_1_recieve").text(snap.val()));
        database.ref('/Genset control/Output status/ORelay/Last/L/OR2last').on('value', snap => $("#Relay_2_recieve").text(snap.val()));
        database.ref('/Genset control/Output status/ORelay/Now/N/OR1now').on('value', snap => $("#Relay_1_now").text(snap.val()));
        database.ref('/Genset control/Output status/ORelay/Now/N/OR2now').on('value', snap => $("#Relay_2_now").text(snap.val()));
        
        //Condition test 
        
        var dbRef= firebase.database().ref("/Genset control/Input command/Relay");
        dbRef.on('value', function(snapshot) {
        snapshot.forEach(function(childSnapshot) {
        var sender_fb=childSnapshot.val();

        //transfer bit to status
        var r1_send=sender_fb.R1;
        var r2_send=sender_fb.R2;

       
  
        if ( r1_send== "1") {
          r1_send = "ON";
        } else {
          r1_send= "OFF";
        }
        if ( r2_send== "1") {
          r2_send = "ON";
        } else {
          r2_send= "OFF";
        }
        document.getElementById("r1_send_tr").innerHTML =  r1_send;
        document.getElementById("r2_send_tr").innerHTML =  r2_send;

    
          //check status firebase-esp
        var dbRef2= firebase.database().ref("/Genset control/Output status/ORelay/Last");
        dbRef2.on('value', function(snapshot) {
        snapshot.forEach(function(childSnapshot) {
        var recieve_esp=childSnapshot.val();

        //condition check status firebase-esp
        var r1_recieve=recieve_esp.OR1last;
        var r2_recieve=recieve_esp.OR2last;
        if ( r1_recieve==  r1_send) {
          r1_recieve = "Working";
        } else {
          r1_recieve= "Not Responding";
        }
        if ( r2_recieve== r2_send) {
          r2_recieve = "Working";
        } else {
          r2_recieve= "Not Responding";
        }
        document.getElementById("r1_recieve_tr").innerHTML =   r1_recieve;
        document.getElementById("r2_recieve_tr").innerHTML =  r2_recieve;

       
        //check status due date
        var dbRef3= firebase.database().ref("/Genset control/Output status/ORelay/Now");
        dbRef3.on('value', function(snapshot) {
        snapshot.forEach(function(childSnapshot) {
        var chk_date=childSnapshot.val();

        //condition check status due date
        var r1_chk_date=chk_date.OR1now;
        var r2_chk_date=chk_date.OR2now;
        
        if ( r1_chk_date==  recieve_esp.OR1last) {
          r1_chk_date = "ยังไม่ครบกำหนด";
        } else {
          r1_chk_date= "ครบกำหนด";
        }
        if ( r2_chk_date==  recieve_esp.OR2last) {
          r2_chk_date = "ยังไม่ครบกำหนด";
        } else {
          r2_chk_date= "ครบกำหนด";
        }
        document.getElementById("r1_chk_date_tr").innerHTML =  r1_chk_date;
        document.getElementById("r2_chk_date_tr").innerHTML =  r2_chk_date;

  
       });
   });
        
  });
   });
  });
});

          $(document).ready(function(){
              $("[id^=Relay_1_button_on]").click(function(){
                alert("Send Relay 1 On");

                turn = "1";
                database.ref('/Genset control/Input command/Relay/R/R1').set(turn);
              });

              $("[id^=Relay_1_button_off]").click(function(){
                alert("Send Relay 1 Off");

                turn = "0";
                database.ref('/Genset control/Input command/Relay/R/R1').set(turn);
              });

              $("[id^=Relay_2_button_on]").click(function(){
                alert("Send Relay 2 On");

                turn = "1";
                database.ref('/Genset control/Input command/Relay/R/R2').set(turn);
              });

              $("[id^=Relay_2_button_off]").click(function(){
                alert("Send Relay 1 Off");

                turn = "0";
                database.ref('/Genset control/Input command/Relay/R/R2').set(turn);
              });

           

              
            });

</script>

<div class="contact">
  <h3>SET RunTime</h3>
  <div class="alert">Your setting has been sent</div>
  <form id="contactForm">
    <p>
      <label>Minute</label>
      <input type="number" name="name" id="name" required>
    </p>
    <p>
      <label>Hour</label>
      <input type="number"  name="company" id="company" required>
    </p>
    <p>
      <label>Date</label>
      <input type="number"  name="email" id="email" required>
    </p>
    <p>
      <label>Month</label>
      <input type="number" name="phone" id="phone" required>
    </p>
    <p class="full">
      <label>Year</label>
      <input type="number" name="message"  id="message" required>
    </p>
    <p class="full">
      <button type="submit">Submit</button>
    </p>
  </form>
</div>


<script src="https://www.gstatic.com/firebasejs/4.3.0/firebase.js"></script>
<script>
// Initialize Firebase (ADD YOUR OWN DATA)
var firebaseConfig = {
      apiKey: "AIzaSyCXHu76M5JSpHJjE14Jt9ypesJMzIe4mh4",
      authDomain: "test-33c48.firebaseapp.com",
      databaseURL: "https://test-33c48.firebaseio.com",
      projectId: "test-33c48",
      storageBucket: "test-33c48.appspot.com",
      messagingSenderId: "910501442006",
      appId: "1:910501442006:web:c4cff17ee5a1f7b7e8f477",
      measurementId: "G-5YNB8F0YM7"
  };
// Initialize Firebase
firebase.initializeApp(firebaseConfig);

// Reference messages collection
var messagesRef = firebase.database().ref('messages');

// Listen for form submit
document.getElementById('contactForm').addEventListener('submit', submitForm);

// Submit form
function submitForm(e){
e.preventDefault();

// Get values
var name = getInputVal('name');
var company = getInputVal('company');
var email = getInputVal('email');
var phone = getInputVal('phone');
var message = getInputVal('message');

// Save message
saveMessage(name, company, email, phone, message);

// Show alert
document.querySelector('.alert').style.display = 'block';

// Hide alert after 3 seconds
setTimeout(function(){
  document.querySelector('.alert').style.display = 'none';
},3000);

// Clear form
document.getElementById('contactForm').reset();
}

// Function to get get form values
function getInputVal(id){
return document.getElementById(id).value;
}

// Save message to firebase
function saveMessage(name, company, email, phone, message){

firebase.database().ref('/Genset control/Input command/Time/T/minute').set(name);
firebase.database().ref('/Genset control/Input command/Time/T/hour').set(company);
firebase.database().ref('/Genset control/Input command/Time/T/day').set(email);
firebase.database().ref('/Genset control/Input command/Time/T/month').set(phone);
firebase.database().ref('/Genset control/Input command/Time/T/year').set( message);

}

//check status date response
var date_i= firebase.database().ref("/Genset control/Input command/Time");
  date_i.on('value', function(snapshot) {
  snapshot.forEach(function(childSnapshot) {
  var chk_date_i=childSnapshot.val();

  //condition check status due date
  var chk_date_i_min=chk_date_i.minute;
  var chk_date_i_hr=chk_date_i.hour;
  var chk_date_i_day=chk_date_i.day;
  var chk_date_i_mon=chk_date_i.month;
  var chk_date_i_y=chk_date_i.year;
  


  var date_o= firebase.database().ref("/Genset control/Output status/OTime");
  date_o.on('value', function(snapshot) {
  snapshot.forEach(function(childSnapshot) {
  var chk_date_o=childSnapshot.val();

  //condition check status due date
  var chk_date_o_min=chk_date_o.Ominute;
  var chk_date_o_hr=chk_date_o.Ohour;
  var chk_date_o_day=chk_date_o.Oday;
  var chk_date_o_mon=chk_date_o.Omonth;
  var chk_date_o_y=chk_date_o.Oyear;
  var result 
  if ( chk_date_i_min==  chk_date_o_min &&chk_date_i_hr==  chk_date_o_hr &&chk_date_i_day==  chk_date_o_day  &&chk_date_i_mon==  chk_date_o_mon &&chk_date_i_y==  chk_date_o_y  ) {
    result = "True";
  }
  else{
    result = "False";
  }
  document.getElementById("status").innerHTML = result;


 });
});
});
});
</script>
<style>*{
box-sizing: border-box;
}

body{
background:#ffffff;
color:#485e74;
line-height:1.6;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
padding:1em;
}

.container{
max-width:1170px;
margin-left:auto;
margin-right:auto;
padding:1em;
}

ul{
list-style: none;
padding:0;
}

.brand{
text-align: center;
}

.brand span{
color:#fff;
}

.wrapper{
box-shadow: 0 0 20px 0 rgba(72,94,116,0.7);
}

.wrapper > *{
padding: 1em;
}

.company-info{
background:#c9e6ff;
}

.company-info h3, .company-info ul{
text-align: center;
margin:0 0 1rem 0;
}

.contact{
background:#f9feff;
}

/* FORM STYLES */
.contact form{
display: grid;
grid-template-columns: 1fr 1fr;
grid-gap:20px;
}

.contact form label{
display:block;
}

.contact form p{
margin:0;
}

.contact form .full{
grid-column: 1 / 3;
}

.contact form button, .contact form input, .contact form textarea{
width:100%;
padding:1em;
border:1px solid #c9e6ff;
}

.contact form button{
  
width:100%;
background:#6164ec;
border:0;
text-transform: uppercase;
}

.contact form button:hover,.contact form button:focus{
background:#9b92e7;
color:#fff;
outline:0;
transition: background-color 2s ease-out;
}

.alert{
text-align: center;
padding:10px;
background:#79c879;
color:#fff;
margin-bottom:10px;
display:none;
}

/* LARGE SCREENS */
@media(min-width:700px){
.wrapper{
display: grid;
grid-template-columns: 1fr 2fr;
}

.wrapper > *{
padding:2em;
}

.company-info h3, .company-info ul, .brand{
text-align: left;
}
}</style>


Response : 
<span id="status"></span>


</body>
</html>
